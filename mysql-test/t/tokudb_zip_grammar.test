#
# Test TokuDB compression option additions to row_format
#
--source include/have_innodb.inc

#
# InnoDB returns a warning on unsupported format if InnoDB strict mode off
#
SET @@SESSION.innodb_strict_mode=OFF;

CREATE TABLE t1 (a INT) ENGINE=InnoDB ROW_FORMAT=TOKUDB_UNCOMPRESSED;

ALTER TABLE t1 ROW_FORMAT=TOKUDB_DEFAULT;
ALTER TABLE t1 ROW_FORMAT=TOKUDB_ZLIB;
ALTER TABLE t1 ROW_FORMAT=TOKUDB_SNAPPY;
ALTER TABLE t1 ROW_FORMAT=TOKUDB_QUICKLZ;
ALTER TABLE t1 ROW_FORMAT=TOKUDB_LZMA;
ALTER TABLE t1 ROW_FORMAT=TOKUDB_FAST;
ALTER TABLE t1 ROW_FORMAT=TOKUDB_SMALL;

--error ER_PARSE_ERROR
ALTER TABLE t1 ROW_FORMAT=TOKUDB_UNDEFINED;

SET @@SESSION.innodb_strict_mode=ON;

--error ER_ILLEGAL_HA_CREATE_OPTION
ALTER TABLE t1 ROW_FORMAT=TOKUDB_DEFAULT;
--error ER_ILLEGAL_HA_CREATE_OPTION
ALTER TABLE t1 ROW_FORMAT=TOKUDB_ZLIB;
--error ER_ILLEGAL_HA_CREATE_OPTION
ALTER TABLE t1 ROW_FORMAT=TOKUDB_SNAPPY;
--error ER_ILLEGAL_HA_CREATE_OPTION
ALTER TABLE t1 ROW_FORMAT=TOKUDB_QUICKLZ;
--error ER_ILLEGAL_HA_CREATE_OPTION
ALTER TABLE t1 ROW_FORMAT=TOKUDB_LZMA;
--error ER_ILLEGAL_HA_CREATE_OPTION
ALTER TABLE t1 ROW_FORMAT=TOKUDB_FAST;
--error ER_ILLEGAL_HA_CREATE_OPTION
ALTER TABLE t1 ROW_FORMAT=TOKUDB_SMALL;

#
# Other storage engines silently convert unsupported formats to default
#

CREATE TABLE t2 (a INT) ENGINE=MyISAM ROW_FORMAT=TOKUDB_ZLIB;

CREATE TABLE t3 (a INT) ENGINE=MEMORY ROW_FORMAT=TOKUDB_SNAPPY;

CREATE TABLE t4 (a INT) ENGINE=MEMORY ROW_FORMAT=TOKUDB_QUICKLZ;

CREATE TABLE t5 (a INT) ENGINE=MEMORY ROW_FORMAT=TOKUDB_DEFAULT;

DROP TABLE t1, t2, t3, t4, t5;

#
# Test that the new ROW_FORMAT types are still usable as identifiers
#
CREATE TABLE TOKUDB_UNCOMPRESSED(TOKUDB_ZLIB INT, TOKUDB_SNAPPY INT, TOKUDB_QUICKLZ INT, TOKUDB_LZMA INT, TOKUDB_FAST INT, TOKUDB_SMALL INT, TOKUDB_DEFAULT INT);
DROP TABLE TOKUDB_UNCOMPRESSED;
