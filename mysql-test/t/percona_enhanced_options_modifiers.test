-- source include/have_innodb.inc
#
# first, ensure that we _can_ set various options without limitation
#
SET @TEMP=@@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=1;
SELECT @@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=2;
SELECT @@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=15;
SELECT @@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=@TEMP;
SET @TEMP=@@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=1;
SELECT @@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=2;
SELECT @@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=15;
SELECT @@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=@TEMP;

SET @@GLOBAL.AUTO_INCREMENT_OFFSET=5;

SET @@LOCAL.AUTO_INCREMENT_OFFSET=5;

SELECT @@GLOBAL.BINLOG_ROW_IMAGE;

SELECT @@LOCAL.BINLOG_ROW_IMAGE;

SET @@GLOBAL.BINLOG_ROW_IMAGE= MINIMAL;

SET @@LOCAL.BINLOG_ROW_IMAGE= MINIMAL;

SET @TEMP=@@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=100;
SELECT @@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=300;
SELECT @@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=160;
SELECT @@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=@TEMP;

SET @@GLOBAL.INNODB_SPIN_WAIT_DELAY=10;

SET @@GLOBAL.INNODB_READ_AHEAD_THRESHOLD=32;

#
# restart the server with some options modifiers and limits
#
--let $restart_parameters=restart:--auto-increment-increment=7 --minimum-auto-increment-increment=5 --maximum-auto-increment-increment=10 --readonly-auto-increment-offset=TRUE --hidden-binlog-row-image=TRUE --innodb-io-capacity=150 --minimum-innodb-io-capacity=150 --maximum-innodb-io-capacity=200 --readonly-innodb-spin-wait-delay=TRUE --hidden-innodb-read-ahead-threshold=TRUE
--source include/restart_mysqld.inc

#
# test the limits set by the above options modifiers
#
SET @TEMP=@@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=1;
SELECT @@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=2;
SELECT @@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=15;
SELECT @@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=@TEMP;
SET @TEMP=@@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=1;
SELECT @@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=2;
SELECT @@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=15;
SELECT @@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=@TEMP;

--error ER_INCORRECT_GLOBAL_LOCAL_VAR
SET @@GLOBAL.AUTO_INCREMENT_OFFSET=5;

--error ER_INCORRECT_GLOBAL_LOCAL_VAR
SET @@LOCAL.AUTO_INCREMENT_OFFSET=5;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SELECT @@GLOBAL.BINLOG_ROW_IMAGE;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SELECT @@LOCAL.BINLOG_ROW_IMAGE;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SET @@GLOBAL.BINLOG_ROW_IMAGE= MINIMAL;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SET @@LOCAL.BINLOG_ROW_IMAGE= MINIMAL;


SET @TEMP=@@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=100;
SELECT @@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=300;
SELECT @@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=160;
SELECT @@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=@TEMP;

--error ER_INCORRECT_GLOBAL_LOCAL_VAR
SET @@GLOBAL.INNODB_SPIN_WAIT_DELAY=10;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SET @@GLOBAL.INNODB_READ_AHEAD_THRESHOLD=32;

#
# Now test allowed modifier combinations
#
--let $restart_parameters=restart:--readonly-loose-auto-increment-offset=TRUE --hidden-loose-binlog-row-image=TRUE --readonly-loose-innodb-spin-wait-delay=TRUE --hidden-loose-innodb-read-ahead-threshold=TRUE
--source include/restart_mysqld.inc

--error ER_INCORRECT_GLOBAL_LOCAL_VAR
SET @@GLOBAL.AUTO_INCREMENT_OFFSET=5;

--error ER_INCORRECT_GLOBAL_LOCAL_VAR
SET @@LOCAL.AUTO_INCREMENT_OFFSET=5;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SELECT @@GLOBAL.BINLOG_ROW_IMAGE;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SELECT @@LOCAL.BINLOG_ROW_IMAGE;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SET @@GLOBAL.BINLOG_ROW_IMAGE= MINIMAL;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SET @@LOCAL.BINLOG_ROW_IMAGE= MINIMAL;

--error ER_INCORRECT_GLOBAL_LOCAL_VAR
SET @@GLOBAL.INNODB_SPIN_WAIT_DELAY=10;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SET @@GLOBAL.INNODB_READ_AHEAD_THRESHOLD=72;
