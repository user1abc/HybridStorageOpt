#
# Test bug 1260259: XTRADB_RSEG query crashes if innodb_undo_logs < default
#
--source include/have_innodb.inc

call mtr.add_suppression("InnoDB: New log files created");
# The temporary system tablespace does not have the mysql schema InnoDB tables
call mtr.add_suppression("InnoDB: Cannot open table mysql/");
call mtr.add_suppression("InnoDB: Creating foreign key constraint system tables.");
call mtr.add_suppression("Info table is not ready to be used.");
call mtr.add_suppression("Failed to open optimizer cost constant tables");
call mtr.add_suppression("Can't open and lock time zone table");
call mtr.add_suppression("Can't open the mysql.plugin table");
call mtr.add_suppression("Gtid table is not ready to be used");
call mtr.add_suppression("Can't open and lock privilege tables");
call mtr.add_suppression("InnoDB: Cannot open table sys/sys_config from the internal data dictionary");

SELECT @@innodb_rollback_segments;
SELECT @@innodb_undo_logs;
SHOW STATUS LIKE 'Innodb_available_undo_logs';

--replace_column 6 # 8 #
SELECT * FROM INFORMATION_SCHEMA.XTRADB_RSEG;

# Remove the temporary system tablespace and redo logs as soon when mysqld quits
--error 0,1
remove_file $MYSQL_TMP_DIR/ib1260259;
--error 0,1
remove_file $MYSQL_TMP_DIR/ib_logfile0;
--error 0,1
remove_file $MYSQL_TMP_DIR/ib_logfile1;
